<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rang">
<title>Create research compendia • rang</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.8/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.8/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create research compendia">
<meta property="og:description" content="rang">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rang</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/compendium.html">Create research compendia</a>
    <a class="dropdown-item" href="../articles/faq.html">FAQ</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/gesistsa/rang/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Create research compendia</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gesistsa/rang/blob/HEAD/vignettes/compendium.Rmd" class="external-link"><code>vignettes/compendium.Rmd</code></a></small>
      <div class="d-none name"><code>compendium.Rmd</code></div>
    </div>

    
    
<p>There has been several implementations of research compendium in the
R ecosystem already: <code>rrtools</code>, <code>rcompendium</code>,
<code>template</code>, <code>manuscriptPackage</code>, and
<code>ProjectTemplate</code>. The idea of <code><a href="../reference/use_rang.html">use_rang()</a></code> is not
to create a new format. Instead, <code><a href="../reference/use_rang.html">use_rang()</a></code> can be used to
<strong>enhance</strong> your current research compendium.</p>
<p>If you would like to create a new research compendium, you can either
use any of the aforementioned formats; or to use
<code><a href="../reference/create_turing.html">create_turing()</a></code> to create a structure suggested by The
Turing Way. However, the idea is that <code><a href="../reference/use_rang.html">use_rang()</a></code>, a
<code>usethis</code>-style function, is a general function that can work
well with any structure. Just like <code>rang</code> in general,
<code><a href="../reference/use_rang.html">use_rang()</a></code> is designed with interoperability in mind.</p>
<div class="section level2">
<h2 id="case-1-create-a-turing-style-research-compendium">Case 1: Create a Turing-style research compendium<a class="anchor" aria-label="anchor" href="#case-1-create-a-turing-style-research-compendium"></a>
</h2>
<p><code><a href="../reference/create_turing.html">create_turing()</a></code> can be used to create a general research
compendium structure. The function generates an example structure like
this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode txt"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>.</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>├── bibliography.bib</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>├── CITATION</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>├── code</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>│   ├── 00_preprocess.R</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>│   └── 01_visualization.R</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>├── data_clean</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>├── data_raw</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>│   └── penguins_raw.csv</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>├── figures</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>├── .here</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>├── inst</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>│   └── rang</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>│       └── update.R</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>├── Makefile</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>└── paper.Rmd</span></code></pre></div>
<p>More information about this can be found in <a href="https://the-turing-way.netlify.app/reproducible-research/compendia.html" class="external-link">the
Turing Way</a>. But in general:</p>
<ol style="list-style-type: decimal">
<li>Raw data should be in the directory <code>data_raw</code>
</li>
<li>Scripts should be in the directory <code>code</code>, preferably
named in the execution order.</li>
<li>The scripts should generate intermediate data files in
<code>data_intermediate</code>, figures in <code>figures</code>.</li>
<li>After the code execution, a file for the manuscript is written with
literate programming techniques. In this case,
<code>Paper.Rmd</code>.</li>
</ol>
<p>The special part is <code>inst/rang/update.R</code>. Running this
script does the following things:</p>
<ol style="list-style-type: decimal">
<li>It scans the current directory for all R packages used.</li>
<li>It creates the infrastructure for building the Docker image to run
the code.</li>
<li>It caches all R packages.</li>
</ol>
<p>As written in the file, you should edit this script to cater for your
own needs. You might also need to run this multiple time during the
project lifecycle. You can also use the <code>Makefile</code> included
to pull off some of the tasks. For example, you can run
<code>make update</code> to run <code>inst/rang/update.R</code>. We
highly recommend using GNU Make.</p>
<p>The first step is to run <code>inst/rang/update.R</code>. You can
either run it by <code>Rscript inst/rang/update.R</code> or
<code>make update</code>. It will determine the snapshot date, scan the
current directory for R dependencies, determine the dependency graph,
generate <code>Dockerfile</code>, and cache R packages.</p>
<p>After running it, you should have <code>Dockerfile</code> at the root
level. In <code>inst/rang</code>, you should have <code>rang.R</code>
and <code>cache</code>. Now, you can build the Docker image. We
recommend using GNU Make and type <code>make build</code> (or
<code>docker build -t yourprojectimg .</code>). And launch the Docker
container (<code>make launch</code> or
<code>docker run --rm --name "yourprojectcontainer" -ti yourprojectimg</code>).
Another idea is to launch a Bash shell (<code>make bash</code> or
<code>docker run --rm --name "yourprojectcontainer" --entrypoint bash -ti yourprojectimg</code>).
Let’s assume you take this approach.</p>
<p>Inside the container, you will get all your files. And that container
should have all the dependencies installed and you can run all the
scripts right away. Let’s say</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> code/00_preprocess.R </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> code/01_visualization.R </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"rmarkdown::render('paper.Rmd')"</span></span></code></pre></div>
<p>You can copy any artefact generated inside the container from
<strong>another shell instance</strong>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> cp yourprojectcontainer:/paper.pdf ./</span></code></pre></div>
<div class="section level3">
<h3 id="other-ideas">Other ideas<a class="anchor" aria-label="anchor" href="#other-ideas"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Add a readme: <code>usethis::use_readme()</code>
</li>
<li>Add a license: <code>usethis::use_mit_license()</code>
</li>
<li>Add the steps to run the code in the <code>Makefile</code>, but
you’ll need to rerun <code>make build</code>.</li>
<li>Export the Docker image: <code>make export</code> and restore it
<code>make restore</code>
</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="case-2-enhance-an-existing-research-compendium">Case 2: Enhance an existing research compendium<a class="anchor" aria-label="anchor" href="#case-2-enhance-an-existing-research-compendium"></a>
</h2>
<p>Oser et al. shared their data as a zip file on <a href="https://osf.io/y7cg5" class="external-link">OSF</a>. You can obtain a copy using
<code>osfr</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"osfr::osf_download(osfr::osf_retrieve_file('https://osf.io/y7cg5'))"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span> meta-analysis<span class="dt">\ </span>replication<span class="dt">\ </span>files.zip</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> meta-analysis</span></code></pre></div>
<p>Suppose you want to use Apptainer to reproduce this research. At the
root level of this compendium, run:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"rang::use_rang(apptainer = TRUE)"</span> </span></code></pre></div>
<p>This compendium is slightly more tricky because we know that there is
one undeclared GitHub package. You need to edit
<code>inst/rang/update.R</code> yourself. In this case, you also want to
fix the <code>snapshot_date</code>. Also, you know that “texlive” is not
needed.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pkgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_pkgrefs.html">as_pkgrefs</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pkgs</span><span class="op">[</span><span class="va">pkgs</span> <span class="op">==</span> <span class="st">"cran::dmetar"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"MathiasHarrer/dmetar"</span></span>
<span></span>
<span><span class="va">rang</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resolve.html">resolve</a></span><span class="op">(</span><span class="va">pkgs</span>,</span>
<span>                snapshot_date <span class="op">=</span> <span class="st">"2021-08-11"</span>,</span>
<span>                verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/apptainerize.html">apptainerize</a></span><span class="op">(</span><span class="va">rang</span>, output_dir <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, cache <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             post_installation_steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">recipes</span><span class="op">[[</span><span class="st">"make"</span><span class="op">]</span><span class="op">]</span>, <span class="va">recipes</span><span class="op">[[</span><span class="st">"clean"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>             insert_readme <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             copy_all <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>             cran_mirror <span class="op">=</span> <span class="va">cran_mirror</span><span class="op">)</span></span></code></pre></div>
<p>You can also edit <code>Makefile</code> to give the project a handle.
Maybe “oser” is a good handle.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dt">handle</span><span class="ch">=</span><span class="st">oser</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ot">.PHONY:</span><span class="dt"> update build launch bash daemon stop export</span></span></code></pre></div>
<p>Similar to above, we first run <code>make build</code> to build the
Apptainer image. As the handle is “oser”, it generates an Apptainer
image called “oserimg.sif”.</p>
<p>Similar to above, you can now launch a bash shell and render the
RMarkdown file.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">make</span> bash</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">"rmarkdown::render('README.Rmd', output_file = 'output.html')"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span></span></code></pre></div>
<p>Upon you exit, you have “output.html” in your host machine. You don’t
need to transfer the file from the container. Please note that this
feature is handy but can also have a <a href="https://the-turing-way.netlify.app/reproducible-research/renv/renv-containers#words-of-warning" class="external-link">negative
impact to reproducibility</a>.</p>
</div>
<div class="section level2">
<h2 id="what-to-share">What to share?<a class="anchor" aria-label="anchor" href="#what-to-share"></a>
</h2>
<p>It is important to know that there are at least two levels of
reproducibility: 1) Whether your computational environment can be
reproducibly reconstructed, and 2) Whether your analysis is
reproducibility. The discussion of reproducibility usually conflates the
two. We want to focus on the 2nd goal.</p>
<p>If your goal is to ensure other researchers can have a compatible
computational environment that can (re)run your code, The Turing Way <a href="https://the-turing-way.netlify.app/reproducible-research/renv/renv-containers#long-term-storage-of-container-images" class="external-link">recommends</a>
that one should share the research compendium and the container images,
not just the recipes e.g. <code>Dockerfile</code> or
<code>container.def</code>. There are many moving parts during the
reconstruction, e.g. whether the source Docker image is available and
usable. As long as Docker or Apptainer support the same image format (or
allow upgrade the current format), sharing the images is the most future
proof method.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Chung-hong Chan, David Schoch.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
